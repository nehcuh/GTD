#+TITLE: 有意思的概率计算

* 引言

最近笔者常去的一家咖啡厅店庆，当天晚上所有饮料免费喝，小吃蛋糕随意吃，而且为了让参加店庆的顾客交流，
活跃气氛，店里还准备了各种游戏，譬如，德州扑克，筛子猜大小等等。

笔者比较少玩类似的赌博游戏，色子猜大小也是第一次玩，结果三两次就把筹码输了个精光。站在旁边，看着漂亮
的小姐姐们玩的不亦乐乎，动不动就来个 1 赔 6，也是很有趣的。

看着看着，笔者就觉得奇怪，猜大小的赔率分配挺有意思。这里解释一下，荷官的色盅里有三个色子，每次玩客可
以根据台面指示进行投注，台面如下，不同的区域会有不同的赔率

[[file:img/001.jpg]]

现场赢得多的小姐姐一般都会押注从12 到 9 之间，虽然是 1 赔 6，相比押注其他区域，已经挺大的了，而且还
屡屡能中，真是奇怪。

直觉上来看，每个色子掷出从 1 到 6 点是等概率的，为什么从 9 到 12 点钟的概率那么大，有点反直觉，而且
台面设置也是将这一区间设置的赔率相比其他区域赔率要低。于是，出于好玩的心理，笔者试着算了一下，并试着
对读者们进行一些科普，因为类似的随机变量的期望值计算在金融市场上的应用也是挺多的。

* 掷骰子的数学

简单起见，笔者这里以掷硬币为例，如果硬币是正常的，那么每次投掷硬币，硬币正反面的概率都是
$\frac{1}{2}$, 于是，在投掷 $N$ 次后，我们可以计算投掷硬币的总的期望值 (正面为 1， 反面为 0):

\begin{equation}
    E(X_A) = \sum_i^N (\frac{1}{2} \times 1 + \frac{1}{2}\times 0) = \frac{N}{2}
\end{equation}


#+BEGIN_QUOTE
一般地，给定一个样本空间 S 和事件 A, 我们定义 A 为指示器随机变量，如果其满足
\begin{equation}
    I(A) = \left\{
    \begin{array}{l}
    1, \quad \text{if A happen}\\
    0, \quad \text{if A does not happend}
    \end{array}
\end{equation}
#+END_QUOTE

对于投掷硬币，每次硬币出现正面或者反面，这样的事情无疑属于指示器随机变量，回到投掷色子，这样的事件一
样是指示器随机变量，不过，此时，如果我们想要计算投掷 $N$ 次色子，得到的总点数，就需要做一个简单变形，
即

\begin{aligned}
    E(TotalPoints) &= \sum_i^N(Point \times Pr(Point))\\
    &= 1\times\frac{1}{6} + 2\times\frac{1}{6} \ldots + 6 \times \frac{1}{6}\\
    &= 3.5
\end{aligned}

如果色盅里有三个色子，三个色子彼此是独立的，每次摇色盅，相当于投掷三次色子，于是相应的期望值为
$3.5\times 3 = 10.5$. 台面上与期望值 10.5 最接近的无疑是 9, 10, 11, 12, 当然，如果读者感兴趣的话，完
全可以计算色子投掷的标准差，计算起来也比较方便，利用 $\sigma^2 = E(X^2) - E(\bar{X})^2$ 来计算。 笔
者偷懒，直接用 ~numpy~ 计算了

#+BEGIN_SRC python
import numpy as np

arr = np.arange(1, 7)
print(arr.std())
print(10.5 - arr.std())
print(10.5 + arr.std())
#+END_SRC

#+RESULTS:
: 1.707825127659933
: 8.792174872340066
: 12.207825127659934

考虑到大数定律，色子落在 9 ~ 12 的概率，大约到 60%，无疑，这样的概率已经很大的了，笔者在其他区域乱投注，输了也
是活该！

* 柏拉图的爱情麦园

其实在生活中，类似的场景还是挺多的，笔者当然不建议去赌博，赌博实在不是个好玩意，不过，赌博中用到的数
学，博弈论，在现实生活中还是真不错。譬如，网上流程的关于柏拉图的麦园的故事。出于准确性的考量，笔者特
意去寻找了下英文版故事的出处，结果发现该故事的真实性存疑，不过现在流传的如此之广，说明这样的故事还是
挺值得品味的，笔者简单简单将故事描述如下：

#+BEGIN_QUOTE
有天，柏拉图问他的老师 (苏格拉底)：“老师，什么是爱情？我应该如何找寻她？” 苏格拉底回答他，“在我们前
面有一片麦田，你去穿过麦田，不能回头，从这片麦田中摘取一片你认为最大的麦穗，如果你能找到，意味着你
找到了爱情。”

柏拉图去麦田寻找最大的麦穗，不久后就回来了，两手空空。他的老师问他，“为何你没有摘取到任何麦穗？”巴拉
图说：“因为我只能选取一次，不能回头，我总担心后面后更大的麦穗，因此，最后什么都没有摘到。”
#+END_QUOTE

下面，让我们用理科生的思维去剖析一下这个问题。柏拉图在穿过麦园之前肯定不知道麦园中的麦穗是什么样的一
个分布，因此，我们可以认为这是一个无先验分布的情形。然后将问题简化一下，柏拉图肯定不可能一棵一课麦子
的所有麦穗全部都看一遍，这样子累死他也看不完整片麦田。因此，我们索性假设每棵麦子有一颗代表性的麦子，
柏拉图需要的是去寻找他能看到的最大的麦穗。

笔者这里先给出在类似情形下最佳策略，然后再引入证明，

#+BEGIN_QUOTE
最佳策略为直接拒掉前 $r-1$ 颗麦穗，这 $r-1$ 颗麦穗中最大的记为 Max，然后从第 r 颗麦穗开始，只要遇到
评分大于 Max 的就选中，没有的话就选取最后一颗麦穗。假设一共有 $n$ 颗麦穗，令 $x = \frac{r}{n}$, 则当
$n$ 趋于无穷的时候， $x\sim\frac{1}{e}$.
#+END_QUOTE

** 说明

其实，这里有一个问题，在结论中给出的是 $\frac{r}{n}$, 当 $n\sim\infty$, 而实际柏拉图并不知道 $n$ 是
多少，只能知道 $n$ 是一个挺大的数，那么 $n$ 到底有多大呢？其实，真的去算，依然很麻烦，笔者这里简单假
设每亩产 500 斤小麦，平均每个小麦重 $0.005g$, 于是， $n$ 估计为 $5\times 10^7$, 这样算起来， $r$ 估
计值就是 $1.8\times10^7$ 左右。数量级在千万级别，嗯，如果我是柏拉图，我还是得疯！！！

** 证明

这里笔者直接摘取知乎上某匿名答主的证明过程 [fn:1]

#+BEGIN_QUOTE
最佳策略为拒掉前 $r$ 个, 其中分数最高的记为 $\text{Max}$ ,然后从第 $r$ 个开始如果遇到评分高于
$\text{Max}$ 的就选中.如果 $i$ 号是最佳选择且被选中,那么其他 $i-1$ 个次佳的都在前 $r-1$ 个被拒者中。
然后根据条件概率展开可得:

[[file:img/equation.png]]

我们的目标是使得这个概率最大化,也就是 $\max P_n(r)$, 先来估计近似解:令 $n$ 趋近无穷大, 把 $x$
表示为 $\frac{r}{n}$ 的极限, 令 $t$ 为 $\frac{i}{n}$ , 则 $\text{d} t$ 为 $\frac{1}{n}$,
原式可以近似为如下积分:

\begin{equation}
    P(x) \sim x \int^1_x \frac{1}{t} \text{d}t = -x\ln x
\end{equation}

求导易得 $x=\frac{1}{e}$ 时取得最大值.
#+END_QUOTE





** 推广

作为证明的一个结论，在生活中，当我们面临不可避免的选择的时候，有时帮助会很大，譬如，经常会有女生会问，
我要经历过多少个臭男人才能找到真爱，同样，会有男生也会问，到底哪个妹纸才会值得我一生相伴。一个简单的
计算，譬如，假如普通人预期最多谈十次恋爱的话，但是又不会真的去谈 10 次恋爱的时候，最简单的方式去前三
个恋爱对象当积攒经验，第四个开始，如果比之前两个好，直接就嫁 (娶) 了吧。因为， $10/e\sim 3.6$.

当然，笔者不建议大家如此轻易地去对待感情，而且，类似计算的理论值是当 $n\sim \infty$ 才成立，奉劝所有
读者朋友，1. 感情是大事，需要慎重对待 2. 远离赌博，利国利民！！！

* 量化中的应用引申

笔者公众号虽然叫做 “笨牛棚”，但是宣传的口号是量化技术的推广，扯了这么多，还是应该试着加入些量化的东
东，那么，上面讲了那么多数学，有啥子用咧？

笔者想了下，嗯，现在 A 股 3500 多支股票，作为普通投资者肯定不可能去所有股票都买一遍，那么，一个简单
的问题，普通投资者买入多少支股票，可以选到自己最心仪的标的呢？或者，经常地，读者朋友们去做股票筛选，
一下子筛选出了 100 支股票，但是自己资金又有限，可能只能选某一支股票买入，那么，最佳的策略是如何？

嗯，经过上面的简单论证，似乎答案会变得简单很多。直接将候选股票随机排列一番，然后除以 $e$ 指数，然后
直接拒绝前面 $r-1$ 支股票，从第 $r$ 支开始，只要盘中触发信号，那就买入。

譬如笔者之前介绍的五连阳的简单示例，似乎就可以这么用一下，时间和精力有限，笔者先落笔于此，下一篇笔者
会介绍基于盘中分钟数据，实时更新跨周期全市场技术指标计算。感兴趣的朋友，可以提前留言讨论。

* 结语

* Footnotes

[fn:1] https://www.zhihu.com/question/66465943/answer/242869171
